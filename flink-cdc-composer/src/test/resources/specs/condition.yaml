################################################################################
# Licensed to the Apache Software Foundation (ASF) under one or more
# contributor license agreements.  See the NOTICE file distributed with
# this work for additional information regarding copyright ownership.
# The ASF licenses this file to You under the Apache License, Version 2.0
# (the "License"); you may not use this file except in compliance with
# the License.  You may obtain a copy of the License at
#      http://www.apache.org/licenses/LICENSE-2.0
# Unless required by applicable law or agreed to in writing, software
# distributed under the License is distributed on an "AS IS" BASIS,
# WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
# See the License for the specific language governing permissions and
# limitations under the License.
################################################################################

- do: Case When Clause
  projection: |-
    id_, int_
    CASE int_ WHEN -4 THEN '负' WHEN 4 THEN '正' ELSE '〇' END AS chinese_id
  primary-key: id_
  expect: |-
    CreateTableEvent{tableId=foo.bar.baz, schema=columns={`id_` BIGINT NOT NULL 'Identifier',`int_` INT,`chinese_id` STRING}, primaryKeys=id_, options=()}
    DataChangeEvent{tableId=foo.bar.baz, before=[], after=[1, 4, 正], op=INSERT, meta=()}
    DataChangeEvent{tableId=foo.bar.baz, before=[1, 4, 正], after=[-1, -4, 负], op=UPDATE, meta=()}
    DataChangeEvent{tableId=foo.bar.baz, before=[-1, -4, 负], after=[], op=DELETE, meta=()}
    DataChangeEvent{tableId=foo.bar.baz, before=[], after=[0, null, 〇], op=INSERT, meta=()}
    DataChangeEvent{tableId=foo.bar.baz, before=[0, null, 〇], after=[], op=DELETE, meta=()}
- do: Case When Null Clause
  projection: |-
    id_, int_
    CASE int_ WHEN -4 THEN '负' WHEN 4 THEN '正' END AS chinese_id
  primary-key: id_
  expect: |-
    CreateTableEvent{tableId=foo.bar.baz, schema=columns={`id_` BIGINT NOT NULL 'Identifier',`int_` INT,`chinese_id` STRING}, primaryKeys=id_, options=()}
    DataChangeEvent{tableId=foo.bar.baz, before=[], after=[1, 4, 正], op=INSERT, meta=()}
    DataChangeEvent{tableId=foo.bar.baz, before=[1, 4, 正], after=[-1, -4, 负], op=UPDATE, meta=()}
    DataChangeEvent{tableId=foo.bar.baz, before=[-1, -4, 负], after=[], op=DELETE, meta=()}
    DataChangeEvent{tableId=foo.bar.baz, before=[], after=[0, null, null], op=INSERT, meta=()}
    DataChangeEvent{tableId=foo.bar.baz, before=[0, null, null], after=[], op=DELETE, meta=()}
- do: Case When Condition Clause
  projection: |-
    id_, int_
    CASE WHEN int_ < 0 THEN '负' WHEN int_ > 0 THEN '正' ELSE '〇' END AS chinese_id
  primary-key: id_
  expect: |-
    CreateTableEvent{tableId=foo.bar.baz, schema=columns={`id_` BIGINT NOT NULL 'Identifier',`int_` INT,`chinese_id` STRING}, primaryKeys=id_, options=()}
    DataChangeEvent{tableId=foo.bar.baz, before=[], after=[1, 4, 正], op=INSERT, meta=()}
    DataChangeEvent{tableId=foo.bar.baz, before=[1, 4, 正], after=[-1, -4, 负], op=UPDATE, meta=()}
    DataChangeEvent{tableId=foo.bar.baz, before=[-1, -4, 负], after=[], op=DELETE, meta=()}
    DataChangeEvent{tableId=foo.bar.baz, before=[], after=[0, null, 〇], op=INSERT, meta=()}
    DataChangeEvent{tableId=foo.bar.baz, before=[0, null, 〇], after=[], op=DELETE, meta=()}
- do: Case When Null Condition Clause
  projection: |-
    id_, int_
    CASE WHEN int_ < 0 THEN '负' WHEN int_ > 0 THEN '正' END AS chinese_id
  primary-key: id_
  expect: |-
    CreateTableEvent{tableId=foo.bar.baz, schema=columns={`id_` BIGINT NOT NULL 'Identifier',`int_` INT,`chinese_id` STRING}, primaryKeys=id_, options=()}
    DataChangeEvent{tableId=foo.bar.baz, before=[], after=[1, 4, 正], op=INSERT, meta=()}
    DataChangeEvent{tableId=foo.bar.baz, before=[1, 4, 正], after=[-1, -4, 负], op=UPDATE, meta=()}
    DataChangeEvent{tableId=foo.bar.baz, before=[-1, -4, 负], after=[], op=DELETE, meta=()}
    DataChangeEvent{tableId=foo.bar.baz, before=[], after=[0, null, null], op=INSERT, meta=()}
    DataChangeEvent{tableId=foo.bar.baz, before=[0, null, null], after=[], op=DELETE, meta=()}
- do: Coalesce Clause
  projection: |-
    id_
    COALESCE(int_, 17) AS int_fallback
    COALESCE(string_, 'Alice') AS string_fallback
  primary-key: id_
  expect: |-
    CreateTableEvent{tableId=foo.bar.baz, schema=columns={`id_` BIGINT NOT NULL 'Identifier',`int_fallback` INT,`string_fallback` STRING}, primaryKeys=id_, options=()}
    DataChangeEvent{tableId=foo.bar.baz, before=[], after=[1, 4, From A to Z is Lie], op=INSERT, meta=()}
    DataChangeEvent{tableId=foo.bar.baz, before=[1, 4, From A to Z is Lie], after=[-1, -4, 天地玄黄宇宙洪荒], op=UPDATE, meta=()}
    DataChangeEvent{tableId=foo.bar.baz, before=[-1, -4, 天地玄黄宇宙洪荒], after=[], op=DELETE, meta=()}
    DataChangeEvent{tableId=foo.bar.baz, before=[], after=[0, 17, Alice], op=INSERT, meta=()}
    DataChangeEvent{tableId=foo.bar.baz, before=[0, 17, Alice], after=[], op=DELETE, meta=()}
- do: If Clause
  non-null: 'true'
  projection: |-
    id_
    IF(int_ > 0, '正', '非正') AS int_if
    IF(CHAR_LENGTH(string_) > 10, '长' , '短') AS string_if
  primary-key: id_
  expect: |-
    CreateTableEvent{tableId=foo.bar.baz, schema=columns={`id_` BIGINT NOT NULL 'Identifier',`int_if` STRING,`string_if` STRING}, primaryKeys=id_, options=()}
    DataChangeEvent{tableId=foo.bar.baz, before=[], after=[1, 正, 长], op=INSERT, meta=()}
    DataChangeEvent{tableId=foo.bar.baz, before=[1, 正, 长], after=[-1, 非正, 短], op=UPDATE, meta=()}
    DataChangeEvent{tableId=foo.bar.baz, before=[-1, 非正, 短], after=[], op=DELETE, meta=()}
- do: If Clause (With NULL)
  ignore: FLINK-38905
  projection: |-
    id_
    IF(int_ > 0, '正', '非正') AS int_if
    IF(CHAR_LENGTH(string_) > 10, '长' , '短') AS string_if
  primary-key: id_
  expect: |-
    CreateTableEvent{tableId=foo.bar.baz, schema=columns={`id_` BIGINT NOT NULL 'Identifier',`int_if` STRING,`string_if` STRING}, primaryKeys=id_, options=()}
    DataChangeEvent{tableId=foo.bar.baz, before=[], after=[1, 正, 长], op=INSERT, meta=()}
    DataChangeEvent{tableId=foo.bar.baz, before=[1, 正, 长], after=[-1, 非正, 短], op=UPDATE, meta=()}
    DataChangeEvent{tableId=foo.bar.baz, before=[-1, 非正, 短], after=[], op=DELETE, meta=()}
    DataChangeEvent{tableId=foo.bar.baz, before=[], after=[0, 非正, 短], op=INSERT, meta=()}
    DataChangeEvent{tableId=foo.bar.baz, before=[0, 非正, 短], after=[], op=DELETE, meta=()}
